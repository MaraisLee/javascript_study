<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>틱택토</title>
        <style>
            table {
                border-collapse: collapse;
            }
            td {
                border: 1px solid black;
                width: 40px;
                height: 40px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <script>
            const $table = document.createElement('table');
            const $result = document.createElement('div');
            const rows = [];
            let turn = 'o';

            const checkWinner = (target) => {
                /* #1 forEach문으로 위치 찾기
                let rowIndex;
                let cellIndex;
                rows.forEach((row, rIdx) => {
                    row.forEach((cell, cIdx) => {
                        if (cell === target) {
                            rowIndex = rIdx;
                            cellIndex = cIdx;
                        }
                    });
                });
                */
                // #2 table의 특성 활용
                const rowIndex = target.parentNode.rowIndex;
                const cellIndex = target.cellIndex;

                let hasWinner = false;
                // 세로
                if (
                    rows[0][cellIndex].textContent === turn &&
                    rows[1][cellIndex].textContent === turn &&
                    rows[2][cellIndex].textContent === turn
                ) {
                    hasWinner = true;
                }
                // 대각선
                if (
                    rows[0][0].textContent === turn &&
                    rows[1][1].textContent === turn &&
                    rows[2][2].textContent === turn
                ) {
                    hasWinner = true;
                }
                if (
                    rows[0][2].textContent === turn &&
                    rows[1][1].textContent === turn &&
                    rows[2][0].textContent === turn
                ) {
                    hasWinner = true;
                }
                // 가로
                if (
                    rows[rowIndex][0].textContent === turn &&
                    rows[rowIndex][1].textContent === turn &&
                    rows[rowIndex][2].textContent === turn
                ) {
                    hasWinner = true;
                }
                return hasWinner;
            };

            const callback = (e) => {
                if (e.target.textContent) {
                    alert('빈칸이 아닙니다.');
                    return;
                }
                e.target.textContent = turn;
                const hasWinner = checkWinner(e.target);
                if (hasWinner) {
                    $result.textContent = `${turn} 승리!`;
                    $table.removeEventListener('click', callback);
                    return;
                }

                // 무승부 검사

                /* #1 forEach 문
                rows.forEach((row, rIdx) => {
                    row.forEach((cell, cIdx) => {
                        if (!cell.textContent) {
                            draw = false;
                        }
                    });
                });
                */
                // #2 flat 함수 사용
                const draw = rows.flat().every((cell) => cell.textContent);
                if (draw) {
                    $result.textContent = '무승부!';
                    return;
                }

                turn = turn === 'o' ? 'x' : 'o';
            };

            for (let i = 0; i < 3; i++) {
                const $tr = document.createElement('tr');
                const cells = [];
                for (let i = 0; i < 3; i++) {
                    const $td = document.createElement('td');
                    cells.push($td);
                    // $td.addEventListener('click', callback); // 세번이나 addEventListener를 써야함
                    $tr.append($td);
                }
                $table.addEventListener('click', callback); // 이벤트 버블링을 이용해 한번만
                $table.append($tr);
                rows.push(cells);
            }
            document.body.append($table);
            document.body.append($result);
        </script>
    </body>
</html>
