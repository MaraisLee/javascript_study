<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>반응속도</title>
        <style>
            #screen {
                width: 300px;
                height: 200px;
                text-align: center;
                user-select: none;
            }
            #screen.waiting {
                background-color: aqua;
            }
            #screen.ready {
                background-color: red;
                color: white;
            }
            #screen.now {
                background-color: greenyellow;
            }
        </style>
    </head>
    <body>
        <div id="screen" class="waiting">클릭해서 시작하세요</div>
        <div id="result"></div>
        <script>
            $screen = document.querySelector('#screen');
            $result = document.querySelector('#result');

            let startTime;
            let endTime;
            let timeoutId;
            const records = [];
            $screen.addEventListener('click', (e) => {
                if (e.target.classList.contains('waiting')) {
                    //파랑
                    $screen.classList.replace('waiting', 'ready');
                    $result.textContent = '초록화면이 되면 클릭해주세요.';
                    timeoutId = setTimeout(() => {
                        startTime = new Date();
                        $screen.classList.replace('ready', 'now');
                        $result.textContent = '클릭해주세요!';
                    }, Math.floor(Math.random() * 1000) + 2000);
                } else if (e.target.classList.contains('ready')) {
                    //빨강
                    clearTimeout(timeoutId);
                    $screen.classList.replace('ready', 'waiting');
                    $result.textContent =
                        '너무 성급했습니다. 화면이 초록색으로 바뀌면 클릭해주세요.';
                } else if (e.target.classList.contains('now')) {
                    // 초록
                    endTime = new Date();
                    const diff = endTime - startTime;
                    records.push(diff);
                    const sum = records.reduce((a, c) => a + c, 0);
                    $result.textContent = `현재 속도: ${diff}ms, 평균 속도: ${Math.floor(
                        sum / records.length
                    )}ms `;

                    const topFive = records.sort((a, b) => a - b).slice(0, 5);
                    topFive.forEach((element, index) => {
                        $result.append(
                            document.createElement('br'),
                            `${index + 1}위: ${element}ms`
                        );
                    });

                    $screen.classList.replace('now', 'waiting');
                    $result.textContent = '클릭해서 시작하세요!';
                }
            });
        </script>
    </body>
</html>
